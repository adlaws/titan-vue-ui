<template>
    <div
        class="titan--fps pass-through"
    >
        {{ currentSimMode }}
        <br>

        <div style="position:absolute;display:block;width:8em;height:2.25em;right:16px;bottom:96px;background-color:black;color:#08f;padding: 0 5px;">
            <span style="font-size:200%">31</span>
            AUTO
        </div>

        <div
            style="position:absolute;display:block;width:8em;height:1.25em;right:16px;bottom:148px;background-color:black;color:#08f;padding: 0 5px;"
            @click="status.body.hasHead=!status.body.hasHead"
        >
            F-88 A2 (ACOG)
        </div>

        <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 8 16"
            height="128"
            style="position:absolute;bottom:96px;left:16px;"
        >
            <g class="bodyparts">
                <path v-show="status.body.hasHead" ref="head" d="M4 0c-.28 0-.86.22-.69.92 0 0 .08.37.11.6a.88.88 0 01-.44.9s.64.24 1.02.24 1.02-.24 1.02-.24a.88.88 0 01-.44-.9l.1-.6C4.87.22 4.29 0 4 0z" />
                <path ref="leftArm" d="M2.98 2.42c-.17.1-.38.16-.64.17 0 0-.97.13-.75 1.34 0 .1 0 .16-.04.26a3.5 3.5 0 00-.26 1.04C.8 6.63 1.1 6.97.77 7.57c-.23.13-.53.3-.64.5 0 .03-.07.03-.11.07-.04.03-.04.2.19.1 0 0 .07-.07.18-.14 0 .14-.1.97 0 1 0 0 .04.04.12-.03v.17c0 .03.07.13.18-.03 0 0 .11.13.19 0 .07-.17.15-.8.19-.7.03.13-.04.43-.04.5 0 .06.07.13.15.03.15-.87.22-1 .19-1.3-.04-.2.3-.87.4-1.07.53-.77.23-1.2.5-1.77.03-.06.09-.07.13-.03.41-.41.56-.95.62-1.49.04-.36.1-.7-.04-.96z" />
                <path ref="rightArm" d="M5.02 2.42c-.14.26-.08.6-.04.96.06.54.2 1.08.62 1.5.04-.05.1-.04.14.02.26.56-.04 1 .48 1.77.11.2.45.87.41 1.07-.03.3.04.43.2 1.3.07.1.14.03.14-.03 0-.07-.07-.37-.04-.5.04-.1.12.53.2.7.07.13.18 0 .18 0 .11.16.18.06.18.03v-.17c.08.07.12.04.12.04.1-.04 0-.87 0-1l.18.13c.23.1.23-.07.2-.1-.05-.04-.12-.04-.12-.07-.11-.2-.41-.37-.64-.5-.33-.6-.03-.94-.52-2.34a3.5 3.5 0 00-.26-1.04c-.04-.1-.04-.16-.04-.26.22-1.2-.75-1.34-.75-1.34a1.35 1.35 0 01-.64-.17z" />
                <path ref="torso" d="M3.42 1.52zm1.16 0zm-1.15.1zm1.14 0zm-1.14.08zm1.14 0zm-1.15.1zm1.16 0zM3.4 1.9zm1.2 0zm-1.23.1zm1.26 0zm-1.3.07zm1.34 0zm-1.4.1zm1.46 0zm-1.52.07zm1.58 0zm-1.74.14zm1.9 0zm-1.97.05c.14.26.08.6.04.96a2.4 2.4 0 01-.62 1.5l.01.02c.45.93.01 1.2.15 1.69a1.62 2 0 011.23 1 1.62 2 0 01.21.99 1.62 2 0 01.2-.98 1.62 2 0 011.24-1.01c.14-.5-.3-.76.15-1.7l.01-.02a2.4 2.4 0 01-.62-1.49c-.04-.36-.1-.7.04-.96 0 0-.64.24-1.02.24s-1.02-.24-1.02-.24zM5.6 4.87zm-3.2 0zm.45-2.39h-.01.01zm2.3 0h0zm-2.37.03h-.01.01zm2.44 0h0zm-2.6.05H2.6h.02zm2.76 0h0zm-2.84.01zm2.92 0zm-3.01.01h-.02.02zm3.1 0h0zm-3.2 2.27zm3.3 0zm-3.32 0zm3.34 0zm-3.3 0zm3.27 0h-.01zm-3.33 0zm3.38 0zm-3.4.01zm3.41 0zm-3.42.02zm3.44 0zM4 8.59a1.62 2 0 010 .12 1.62 2 0 010-.12zm-1.75.09z" />
                <path ref="leftLeg" d="M2.56 6.59v.01l-.07.17c-.08.7-.56 3.04.04 4.04.48.8-.08 1.54.33 2.87.23.77.12 1.34.19 1.68.04.1.19.13-.3.36-.11.07-.22.34.49.24.11 0 .3.06.37.03 0 0 .19-.03.15-.3 0-.13.04-.57 0-.67-.34-1 .26-1.47.04-2.54-.19-1 .04-1.2 0-1.87-.04-.57-.08-1.64.11-1.8.02-.02.05-.03.09-.03v-.07a1.62 2 0 00-.2-1.11 1.62 2 0 00-1.24-1.01z" />
                <path ref="rightLeg" d="M5.44 6.59a1.62 2 0 00-1.23 1A1.62 2 0 004 8.72H4v.07c.04 0 .07.01.09.03.19.16.15 1.23.11 1.8-.04.67.19.87 0 1.87-.22 1.07.38 1.54.04 2.54-.04.1 0 .54 0 .67-.04.27.15.3.15.3.07.03.26-.03.37-.03.71.1.6-.17.49-.24-.49-.23-.34-.26-.3-.36.07-.34-.04-.9.19-1.68.4-1.33-.15-2.07.33-2.87.6-1 .12-3.34.04-4.04l-.07-.17V6.6z" />
            </g>
        </svg>

        <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 16 16"
            height="128"
            style="position:absolute;bottom:96px;left:64px;"
        >
            <g class="posture">
                <path v-if="status.posture===POSTURE.PRONE" d="M5.9 15.99c-.15-.03-.21-.07-.35-.28-.1-.16-.14-.26-.14-.34 0-.05 0-.05-.06-.06a.88.88 0 01-.24-.07.2.2 0 01-.05-.06l-.03-.04h-.17c-.43-.02-1.1-.2-1.26-.35-.1-.09-.26-.2-.41-.29-.17-.1-.28-.18-.32-.27-.02-.04-.03-.05-.05-.04-.04 0-.12-.04-.22-.13l-.1-.08h-.09a.7.7 0 00-.15.01c-.08.03-.17.01-.2-.03a.34.34 0 01-.05-.1l-.04-.05c-.03 0-.2.13-.29.2a.7.7 0 00-.12.16.48.48 0 01-.18.2.4.4 0 01-.18.03h-.12l-.05-.05a.55.55 0 01-.15-.3.57.57 0 01.05-.37c.06-.11.14-.2.3-.3.12-.1.27-.2.31-.26a.26.26 0 00.04-.08c.03-.1.23-.28.35-.3.1-.02.23.04.28.14.04.07.1.12.16.12.12 0 .32.03.4.05.28.06.56.19.74.35a.3.3 0 00.1.06.6.6 0 01.1.04c.07.03.09.03.25.04l.25.02c.1.02.18.03.28.01l.23-.02c.15 0 .17 0 .23-.04a.27.27 0 00.07-.03 5.23 5.23 0 01.33-.53c.02-.02.03-.04.04-.14l.03-.18c.02-.05.02-.06 0-.12a.7.7 0 01-.02-.18c0-.17.06-.3.17-.44a.76.76 0 00.07-.12 1 1 0 01.2-.26c.1-.1.52-.29.63-.29a.2.2 0 00.08-.03c.05-.03.05-.03.25-.03.13 0 .23 0 .29.02l.08.01v-.27c0-.25 0-.27.02-.35a.71.71 0 01.07-.15l.08-.15a.63.63 0 01.34-.36c.25-.13.48-.2.72-.2.18 0 .27.03.39.09a1.98 1.98 0 01.67.67l.12.2c.03.08.04.1.04.2l-.01.19a.97.97 0 00-.02.12c0 .07-.05.17-.12.23a.98.98 0 01-.1.09c-.02.01-.02.02 0 .1 0 .05.02.1.05.14.04.06.05.08.04.1 0 .05-.08.03.6.11l.54.08c.05.02.07.07.06.16-.01.14.04.26.08.18.02-.04.07-.04.13 0l.05.03.01-.07a.3.3 0 01.02-.08c.01-.01.57 0 1.53.05h.18v.04c.02.08.02.09.2-.2.17-.24.19-.27.23-.28h.08l.04.06.01.31c.01.21.02.27.03.27l.02.02.2.02c.14 0 .2 0 .2.02.02.02.06.02.22.01h.33c.25.03.38.03.38.02 0-.01.3-.02.43 0h.08l.01.05c.02.05.01.13-.01.16-.02.02-.47.01-.5-.01-.02-.01-.1-.02-.33-.02l-.34-.01a.65.65 0 00-.26 0h-.2c-.1 0-.2 0-.2.02V12.93h-.05l-.05-.01v-.07l-.01-.06H12.88l-.01.05c0 .03-.02.05-.03.06l-.08.01c-.07 0-.08.01-.08.04l-.02.02-.03.03c-.01.04-.03.04-.29.05-.23.01-.22 0-.32.1a.46.46 0 01-.15.06c-.1.03-.17.06-.19.08l-.09.07-.12.07-.03.03-.01.15v.15l.03.07c.05.08.09.2.1.3.02.13.01.45-.02.61-.02.08-.03.23-.04.36-.01.26-.03.36-.08.47-.04.1-.1.16-.18.2-.06.03-.08.04-.19.04a.8.8 0 01-.38-.1.43.43 0 01-.23-.25c-.05-.13-.05-.13-.12-.16-.12-.06-.15-.1-.22-.32-.05-.13-.06-.15-.12-.2a4.58 4.58 0 01-.64-.98c-.04-.07-.05-.07-.09-.07l-.06.01-.01.06c0 .05-.04.13-.06.13l-.01.08c0 .06 0 .08-.02.1a.72.72 0 01-.19.1c-.02 0-.02.04 0 .1 0 .04 0 .04-.02.07-.01.02-.03.02-.08.02h-.06c.04.1.04.1 0 .14a.3.3 0 01-.1.09c-.08.04-.1.05-.12.1-.05.1-.07.11-.14.13a.23.23 0 00-.08.02l.03.08.02.1a3.7 3.7 0 01-.52.35s-.04.01-.07.04a.78.78 0 01-.41.15c-.07.01-.07.01-.08-.02l-.01-.03-.06.06c-.09.08-.15.09-.38.08h-.18l-.13.12c-.17.17-.2.19-.4.19H5.9zm4.74-2.67c0-.01.01-.04.03-.05l.02-.02-.03-.07a.3.3 0 01-.03-.09c0-.03-.01-.06-.02-.05v.25c.01.06.03.08.03.03zm2.51-.82a.78.78 0 00-.26 0l.12.01c.13.01.16 0 .14 0zm0-.18v-.1l-.04-.01c-.03 0-.04-.01-.04-.07-.01-.06-.01-.06-.05-.06-.05 0-.05 0-.13.13-.07.1-.08.16-.06.18l.14.02h.16c.01 0 .02 0 .02-.1zm-2.63-.04l.02-.17a.08.08 0 00-.03-.03c-.03-.01-.6-.04-.87-.04h-.13l.03.03.07.13.05.1.43-.01h.43z" />
                <path v-else-if="status.posture===POSTURE.KNEELING" d="M4.21 15.97c.23-.08.4-.23.56-.49.1-.14.11-.16.19-.19a.98.98 0 00.37-.3c.07-.1.1-.1.2 0s.2.16.28.17c.08.02.16-.02.19-.08a.1.1 0 01.05-.05c.05-.01.09-.11.09-.2l-.04-.23c-.07-.3-.07-.35-.01-.56.08-.25.05-.33-.13-.45-.14-.1-.24-.07-.33.08a.27.27 0 01-.07.09.47.47 0 00-.1.12c-.03.06-.07.11-.09.11l-.06-.03c-.04-.03-.04-.04-.01-.09.01-.03.05-.14.07-.25l.08-.23.37-.43c.2-.2.38-.41.41-.46.05-.06.07-.07.13-.07l.17-.03c.05-.02.17-.03.25-.04a2.47 2.47 0 001.07-.33c.17-.09.37-.18.45-.2.2-.07.95-.19.98-.16.03.03-.02.47-.07.7-.04.14-.06.24-.06.4 0 .17 0 .2.04.24.18.22.2.28.14.39a.63.63 0 00-.04.2c0 .14.02.19.1.19.04 0 .05.01.07.13.04.24.03.39-.05.62-.08.25-.1.36-.06.48l.02.27v.17l.06.04c.09.06.25.11.41.13l.15.03.11-.07.12-.06.13.02c.08.01.21.05.3.08a2.93 2.93 0 001.35.07.68.68 0 000-.24v-.08c.03-.12-.02-.17-.25-.26a2.1 2.1 0 00-.32-.1.49.49 0 01-.15-.04 1.1 1.1 0 00-.15-.08 1.7 1.7 0 01-.64-.5 2.19 2.19 0 01-.03-.32l-.01-.25.06-.02c.1-.04.23-.16.25-.23.03-.08 0-.22-.09-.34-.05-.07-.05-.09-.03-.11a.43.43 0 00.09-.24c0-.05-.02-.07-.06-.12l-.06-.05.03-.36c.01-.31.02-.37.05-.4a.83.83 0 00.08-.29l.05-.24-.05-.06c-.03-.03-.04-.07-.03-.09a1.5 1.5 0 00-.08-.5c-.13-.35-.33-.6-.6-.69a19.97 19.97 0 01-.9-.12 3.41 3.41 0 00-1.7.2c-.02 0-.02-.04-.02-.09l-.02-.28v-.2c.02-.01.03-.1.03-.26l.01-.26c.05-.03 0-.43-.05-.51-.05-.07-.04-.17.03-.37.09-.25.09-.26.05-.37-.08-.18-.08-.2.03-.3l.1-.1.07.04c.1.06.4.19.7.3.23.09.26.1.42.1.14 0 .19 0 .25.04.17.09.23.11.33.13.1.01.2 0 .29-.04a.8.8 0 00.23-.19.69.69 0 00.02-.2 1.92 1.92 0 01.06-.47c0-.07.02-.16.04-.21.03-.12.01-.35-.03-.4-.03-.04-.03-.04.02-.06.03-.01.13-.03.22-.03.18-.02.25-.05.28-.12a.13.13 0 000-.1.19.19 0 010-.1l.02-.16.01-.18c.01-.07.01-.08-.03-.12-.04-.03-.05-.07-.06-.13 0-.07 0-.08-.05-.09-.05 0-.05 0-.05-.04l.02-.07s0-.02.02-.02.05-.01.07-.04a.18.18 0 01.1-.03c.05 0 .1-.05.1-.1 0-.02.02-.03.1-.04l.12-.01c.02 0 .03 0 .04.04 0 .04.01.05.05.05s.04 0 .04-.05v-.07l.18-.04a.77.77 0 00.18-.04.9.9 0 01.2-.03c.11 0 .22-.02.25-.03l.24-.02a2.98 2.98 0 00.43-.05c.02 0 .02-.14-.01-.16-.03-.03-.43.02-.46.05l-.19.03-.28.03a4.15 4.15 0 00-.45.04c-.09.01-.12 0-.14-.01a.83.83 0 01-.04-.2c-.04-.27-.05-.31-.1-.31-.07 0-.1.03-.23.28-.12.22-.13.23-.15.2-.02-.04-.03-.05-.14-.04l-1.4.16c-.02 0-.03.03-.03.07 0 .06 0 .06-.03.05-.06-.03-.13-.03-.13 0 0 .05-.06.04-.07 0-.01-.05 0-.05-.32.02l-.2.04-.07-.04a.38.38 0 01-.1-.08l-.04-.06.04-.02c.04-.04.06-.08.1-.23.05-.16.03-.18-.13-.16-.07 0-.25.04-.4.07-.36.08-.42.1-.42.06 0-.02.02-.04.04-.05.08-.04.07-.08-.1-.44a1.07 1.07 0 00-.3-.41c-.21-.22-.34-.29-.53-.29-.31 0-.73.05-.87.11-.13.06-.28.25-.43.57l-.06.14v.25c0 .26.04.57.09.64.01.02.05.04.08.05.12.03.31.2.31.29l-.1.06a.56.56 0 00-.14.08l-.06.02c-.02 0-.06.02-.08.05-.03.04-.04.04-.12.03a1.1 1.1 0 01-.17-.05c-.13-.05-.26-.03-.5.07-.14.06-.2.1-.32.3-.17.24-.17.25-.17.55 0 .28.03.45.1.61.03.05.05.14.06.19 0 .05.04.15.07.22l.07.22c0 .07.03.13.08.2s.07.11.07.18l-.02.1c-.04 0-.05.21-.01.29.03.05.03.1.02.21-.01.11 0 .16.01.19.02.02.04.09.04.15.01.08.01.1-.01.11-.03.01-.03.03-.02.1 0 .05.02.1.03.13.03.04.05.35.03.35-.04 0 0 .17.06.26.05.1.05.1.05.29 0 .18 0 .2.05.22.04.03.04.04.04.08l-.04.25c-.02.12-.04.26-.06.31-.03.09-.03.12 0 .18.01.07.01.08-.07.23-.05.1-.1.15-.11.15-.05.01-.21.36-.21.46 0 .04-.05.18-.12.35-.2.5-.24.7-.16.93l.04.11-.04.17c-.02.1-.05.23-.08.3-.03.12-.04.2-.04.46 0 .17 0 .4-.02.53-.01.19 0 .22.03.33.05.14.15.34.22.41.1.12.29.15.47.09zm4.72-9.12l-.1-.05-.05-.18A4.74 4.74 0 018.63 6c0-.02 0-.06.02-.08.02-.03.02-.04-.01-.07-.02-.02-.03-.06-.03-.12 0-.08 0-.1.07-.16.04-.04.08-.06.09-.05.02.02.11-.01.13-.05.01-.04.04-.03.05.02 0 .03.03.07.04.1l.04.03.32-.05c.18-.04.33-.06.34-.05l-.07.14c-.1.15-.15.24-.15.33 0 .03 0 .08-.02.1l-.1.19c-.03.1-.08.19-.1.22a.72.72 0 00-.12.31c0 .08-.01.09-.06.09a.44.44 0 01-.14-.05zm-1.07-.42a.55.55 0 01-.13-.07.52.52 0 00-.14-.06.14.14 0 01-.08-.05c-.03-.04-.03-.04.04-.03.06.01.1 0 .13-.01a.54.54 0 01.18-.04H8l.03.1.03.14c0 .04 0 .04-.07.03l-.12-.01zm-.4-.3c-.05-.05-.04-.1 0-.1.06.01.09.06.07.1-.01.04-.05.04-.08 0zm.31-.03c0-.04 0-.07-.04-.1-.05-.07-.05-.1 0-.11.1-.02.18.06.18.18 0 .05-.02.06-.1.07-.04 0-.05 0-.04-.04zM7 5.25c0-.01.02-.03.05-.04.06-.03.09-.07.06-.11L7.04 5c-.02-.03-.03-.05-.01-.03.02.02.04.02.08 0 .02 0 .04-.03.04-.04l.06-.01c.05 0 .07.03.03.06v.24a.98.98 0 01-.24.05l-.01-.03zm3.7-.38l.12-.01c.07 0 .07 0 .02.01a.58.58 0 01-.12.01c-.06 0-.06 0-.02-.01zm-.1-.08c-.02-.04.1-.26.14-.27.02 0 .04.01.05.04.01.03.03.05.05.05.02 0 .04.06.04.13 0 .04-.02.05-.18.06l-.08.01s-.02 0-.02-.02zM6.88 4.7c0-.02.04-.04.09-.04.03 0 .05.02.02.04-.02.02-.11.01-.11 0z" />
                <path v-else d="M3.94 15.97c-.14-.04-.27-.12-.32-.21-.05-.1-.06-.42-.01-.59.03-.1.03-.16 0-.48-.02-.46 0-.64.14-.87.1-.17.15-.34.1-.4a.77.77 0 01-.13-.32c0-.04.03-.1.06-.17.04-.05.09-.19.12-.32l.17-.56c.05-.18.1-.34.09-.36-.03-.09.23-.48.31-.48.06 0 .12-.08.14-.19.02-.07.04-.11.09-.15.06-.05.06-.06.04-.13a1.23 1.23 0 01-.01-.3c.02-.27 0-.37-.17-.82a1.39 1.39 0 00-.16-.34c-.06-.06-.08-.09-.19-.47l-.1-.34V8.2l.02-.25-.07-.07c-.1-.1-.1-.15 0-.59l.07-.35-.07-.05-.08-.05.02-.22c0-.17 0-.23-.02-.29-.07-.16-.08-.34-.05-.97.02-.54.02-.6.06-.65.05-.07.05-.26 0-.38-.09-.27-.12-.84-.05-1.19.06-.35.2-.69.36-.88.2-.23.46-.3.82-.23l.15.03.16-.15c.12-.13.17-.16.24-.17l.08-.01-.03-.06-.11-.17a.6.6 0 01-.1-.15A1.7 1.7 0 015.7.6c.1-.18.33-.42.5-.5a1.15 1.15 0 011.35.3c.11.1.22.22.24.25.04.06.11.58.1.72 0 .09-.02.1-.09.17-.04.04-.08.08-.07.09.03.02.13.01.14-.02.02-.04.08-.04.11 0s.06.04.35 0c.28-.04.42-.03.42.04 0 .08-.05.2-.1.26-.08.08-.07.12.01.2l.08.06h.3c.28 0 .31 0 .32.02 0 .04.06.05.06.02 0-.03.04-.02.1 0 .04.02.04.01.04-.03 0-.05.01-.05.11-.05a14.38 14.38 0 011.09.1c.01.04.03.02.13-.15.13-.2.18-.26.23-.22.02.02.03.08.03.25v.22l.05.02c.04.02.27.03.62.03.37 0 .57.01.59.03l.01.08v.05H11.74l-.43-.01h-.13v.06c0 .05-.01.07-.04.07s-.04-.02-.04-.06c0-.04-.01-.05-.1-.05-.08 0-.1.01-.12.05a.1.1 0 01-.07.05.13.13 0 00-.09.06c-.03.06-.03.06 0 .09.02.01.03.05.03.08s0 .08.02.13c.02.06.02.08 0 .12l-.06.05c-.03 0-.04.13-.01.19v.09a.33.33 0 00-.02.1c0 .08 0 .08-.14.13-.1.03-.2.04-.29.04-.14 0-.14 0-.26.1a.76.76 0 01-.13.1L9.83 4a.6.6 0 01-.26.25 1.7 1.7 0 00-.27.2c-.23.22-.3.26-.46.29a.98.98 0 01-.68-.18.4.4 0 00-.18-.06 1.11 1.11 0 01-.36-.13 2.13 2.13 0 00-.25-.12c-.02 0-.1.1-.18.21l-.15.22v.14c0 .1-.02.17-.05.25-.04.08-.05.12-.04.24.01.1 0 .17-.02.28-.05.15-.06.31-.07.63 0 .12-.02.24-.03.28a.57.57 0 00-.02.15c0 .05-.02.08-.05.1-.03.03-.04.07-.04.17 0 .12 0 .12-.06.14-.07.03-.07.03.04.16.03.05.06.1.06.13s.06.1.16.2c.1.09.19.2.22.23.13.18.3.5.42.77.38.85.4.9.47 1.26.09.39-.03.7-.37 1-.15.13-.3.3-.37.43a.75.75 0 00-.04.2.45.45 0 01-.07.22.36.36 0 00-.06.15l-.03.1a.53.53 0 01-.25.12.14.14 0 00-.1.07c-.04.06-.04.06 0 .1.04.04.4.14.6.16.2.02.28.05.36.14.06.07.06.08.05.2 0 .08-.02.16-.03.18-.06.07-.4.15-.66.15a2.8 2.8 0 01-.38-.05l-.26-.05-.05.06c-.06.06-.06.06-.2.05-.23-.02-.34-.05-.4-.11-.08-.06-.07-.04-.06-.45l.01-.21.12-.17.19-.27c.05-.08.06-.1.04-.15-.05-.14 0-.35.1-.38.03-.01.04-.04.05-.17.02-.2.06-.34.15-.52.07-.13.15-.21.42-.45a.4.4 0 00.1-.1c0-.04-.25-.28-.37-.37a.68.68 0 01-.17-.17l-.13-.24c-.09-.16-.28-.4-.32-.42-.03-.01-.03.04.04.7.05.56.07 1.2.03 1.4-.04.16-.13.39-.23.54l-.11.18-.14.18a1.7 1.7 0 00-.16.25l-.2.32c-.23.36-.3.53-.29.77 0 .14 0 .18-.04.26-.08.14-.15.22-.22.26-.07.03-.08.05-.14.2-.03.12-.06.23-.06.34-.01.14 0 .18.06.38l.07.28c0 .04.03.12.07.19.1.16.12.3.1.55 0 .24-.02.27-.16.32-.11.04-.44.04-.58 0zm4.8-12.24c.03-.03.03-.05 0-.27l-.02-.23h-.19c-.21-.01-.22 0-.22.12 0 .06-.02.1-.06.14l-.05.05.1.07c.09.06.31.16.37.16l.07-.04zm.7-.4l.23-.1c.1-.04.12-.05.15-.03.02.02.04.02.08 0a.17.17 0 00.06-.08c0-.02.07-.09.14-.16a.75.75 0 00.13-.14l-.32-.03H9.6l-.02-.1c-.03-.07-.03-.08-.07-.04a.1.1 0 01-.08.02c-.04 0-.06 0-.1.04-.03.05-.03.07-.02.2v.18c-.03.03-.02.3.01.3l.13-.06zm-.78-.24c0-.05-.01-.1-.03-.12-.02-.03-.03-.02-.07.03a.4.4 0 00-.05.13c-.01.05-.01.05.07.05h.08v-.1zm-1.15-.23l.17-.08-.05-.07-.06-.08-.04.04c-.04.04-.07.05-.18.05h-.13l-.01.08v.11c.04.05.15.03.3-.05zm3.54-.52H11h.05zM7.68 2.3l.02-.05c0-.03.01-.04.07-.04l.16-.01.1-.02v-.1l.01-.11c.01 0 .02-.02.02-.05 0-.04-.06-.05-.1 0-.03.03-.07.03-.1 0-.02-.06-.18-.03-.21.02-.02.03-.06.05-.1.05-.05 0-.07.02-.07.06 0 .07-.05.16-.07.16-.02 0-.02.09 0 .1.01.02.24 0 .27-.01zm3.43-.08a.17.17 0 00-.03-.08.16.16 0 01-.03-.08c0-.07-.08-.03-.13.06-.08.14-.08.15.06.15.12 0 .13 0 .13-.05z" />
            </g>
        </svg>

        <router-link :to="{name:'desktop'}">
            EXIT FPS
        </router-link>
    </div>
</template>

<script>
import { TITAN_MUTATION, TITAN_UI_MODE } from '@/assets/js/store/titan-manager.js';
import TitanUtils, { $tWorldInterface, /*$tEventInterface,*/ $isInsideTitan, $tLogger, SIM_MODE, CAMERA_MODE, FREE_CAMERA_MODE } from '@/assets/js/titan/titan-utils.js';
import MathUtils from '@/assets/js/utils/math-utils.js';

const HEALTHY = {h:120,s:100,l:33};
const DEAD = {h:0,s:100,l:50};

// ref: src\titan_module_hyperion\interfaces\EntityInterface.cpp: getCharacterPose()
const POSTURE = {
    STANDING: 0,
    CROUCHING: 1,
    KNEELING: 2,
    PRONE: 3,
    CLIMBING: 4,
    PARACHUTING: 5,
    SWIMMING: 6,
};

export default {
    name: 'titan-fps',
    data()
    {
        return {
            activeScenario: null,
            activeCamera: null,
            cachedCameraPosRot: null,
            entity: null,
            status:
            {
                body:
                {
                    hasHead: true,
                    head:100.0,
                    leftArm:100.0,
                    rightArm:100.0,
                    torso:100.0,
                    leftLeg:100.0,
                    rightLeg:100.0,
                },
                posture: POSTURE.STANDING,
            },
            POSTURE
        };
    },
    computed:
    {
        currentSimMode() { return this.$store.getters.titanSimMode; },
    },
    watch:
    {
        'status.body.head': function(newHealth,/*oldHealth*/) {this.$refs.head.style.fill = this.healthColor(newHealth);},
        'status.body.leftArm': function(newHealth,/*oldHealth*/) {this.$refs.leftArm.style.fill = this.healthColor(newHealth);},
        'status.body.rightArm': function(newHealth,/*oldHealth*/) {this.$refs.rightArm.style.fill = this.healthColor(newHealth);},
        'status.body.torso': function(newHealth,/*oldHealth*/) {this.$refs.torso.style.fill = this.healthColor(newHealth);},
        'status.body.leftLeg': function(newHealth,/*oldHealth*/) {this.$refs.leftLeg.style.fill = this.healthColor(newHealth);},
        'status.body.rightLeg': function(newHealth,/*oldHealth*/) {this.$refs.rightLeg.style.fill = this.healthColor(newHealth);},
    },
    mounted()
    {
        $tLogger.info(window.TitanEvent);

        this.$store.commit(TITAN_MUTATION.ENTER_UI_MODE, TITAN_UI_MODE.FPS);
        this.$store.commit(TITAN_MUTATION.CHANGE_SIM_MODE, SIM_MODE.PLAY);

        this.$refs.head.style.fill = this.healthColor(this.status.body.head);
        this.$refs.leftArm.style.fill = this.healthColor(this.status.body.leftArm);
        this.$refs.rightArm.style.fill = this.healthColor(this.status.body.rightArm);
        this.$refs.torso.style.fill = this.healthColor(this.status.body.torso);
        this.$refs.leftLeg.style.fill = this.healthColor(this.status.body.leftLeg);
        this.$refs.rightLeg.style.fill = this.healthColor(this.status.body.rightLeg);

        if($isInsideTitan)
        {
            // $tWorldInterface.flushCallbackFunctions(); // TODO: What is this for, exactly?
            this.activeScenario = $tWorldInterface.getActiveScenario();
            this.activeCamera = this.activeScenario.getActiveCamera();

            // cache the current position and orientation of the camera so that we can
            // restore it when we exit the scenario
            this.cachedCameraPosRot = {
                position: this.activeCamera.getPosition(),
                orientation: this.activeCamera.getRotation()
            };

            // find the entity with direct control (if any) and disable control
            const controlledEntity = this.activeScenario.get_direct_control_vehicle();
            if( controlledEntity )
                controlledEntity.disableDirectControl();

            // create an entity at the location in the middle of the screen
            const worldPos = TitanUtils.worldPosForWindowCoords({x:screen.availWidth/2, y:screen.availHeight/2});
            this.entity = TitanUtils.createEntity('aus_soldier_camcu', worldPos);
            // control the created entity
            this.entity.enableDirectControl();

            // get notified of entity changes to stuff
            const entityEventSystem = this.entity.getEventSystem();
            entityEventSystem.bindCallbackFunction('CharacterPostureChanged_EventInstant', ()=>
            {
                // $tLogger.info('CharacterPostureChanged_EventInstant!!');
                this.status.posture = this.entity.getCharacterPose();
                // $tLogger.info(this.entity.getCharacterPoseData());
            });

            this.activeCamera.setCameraMode( CAMERA_MODE.FIRST_PERSON );
            this.activeScenario.scenarioEntered(true);
            $tWorldInterface.pause(false);
        }
    },
    beforeDestroy()
    {
        // clean up after ourselves
        if($isInsideTitan)
        {
            $tWorldInterface.pause(true);
            this.activeScenario.scenarioEntered(false);

            const controlledEntity = this.activeScenario.get_direct_control_vehicle();
            if( controlledEntity )
                controlledEntity.disableDirectControl();
            this.entity.remove();

            // NOTE: for some reason cant' immediately set the free camera mode after
            // setting the camera mode, so we have to do a little 100ms wait here.
            this.activeCamera.setCameraMode( CAMERA_MODE.FREEVIEW );
            setTimeout(()=>
            {
                this.activeCamera.setFreeCameraMode( FREE_CAMERA_MODE.AUTO_ROLL );

                // restore the cached position of the standard camera
                this.activeCamera.setPosition(this.cachedCameraPosRot.position);
                this.activeCamera.setRotation(this.cachedCameraPosRot.orientation);
            }, 100);
        }

        this.$store.commit(TITAN_MUTATION.CHANGE_SIM_MODE, SIM_MODE.MENU);
        this.$store.commit(TITAN_MUTATION.EXIT_UI_MODE, TITAN_UI_MODE.FPS);
    },
    methods:
    {
        healthColor(health) { return this.hslStr(MathUtils.interpolate(DEAD, HEALTHY, health/100.0));},
        hslStr: (hsl) => 'hsl('+hsl.h+','+hsl.s+'%,'+hsl.l+'%)'
    }
};
</script>

<style lang="scss">
.bodyparts
{
    path
    {
        transition: fill 0.5s ease-in-out;
    }
}
</style>